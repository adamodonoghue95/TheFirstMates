package poker;
import java.util.Random;
import java.util.Scanner;

public class PokerPlayer {

	protected HandOfCards playerHand;
	protected String name;
	private int chips;
	protected boolean inHand = true;
	protected int lastBet = 0;

	public PokerPlayer(DeckOfCards cardDeck, String playerName){
		playerHand = new HandOfCards(cardDeck);
		chips = 10;
		//System.out.println("What is your name?");
		name = playerName;
	}

	public String prompt() {
		Scanner scanner = new Scanner(System.in);
		String input = scanner.nextLine();
		input = input.trim();
		return input;
	}

	//	public void bet(int chipsBet) {
	//		if (this.chips > 0) {
	//			this.chips -= chipsBet;
	//		}
	//		else {
	//			System.out.println("Bankrupt");
	//		}
	//	}

	public void chipsWon(int noOfChips) {
		chips += noOfChips;
	}

	public void returnCards(DeckOfCards deck) {
		// returns all cards back to the deck
		for (int i = 0; i < playerHand.HAND_SIZE; i++) {
			deck.returnCard(playerHand.getCard(i));
		}

	}

	public void newHand(DeckOfCards deck) {
		// Gives player new hand
		playerHand = new HandOfCards(deck);
	}

	public String getChipsToRaise(String content) {
		String output = "";
		int chipsBet = 0;
		Random rand = new Random();
		String errorMsg = "Bet error " + rand.nextInt(100) + ": ";

		if(chips == 0){
			output = "You do not have any chips to raise with";
		}
		else{
			try {
				chipsBet = Integer.parseInt(content);

				if (chipsBet > chips) { // Cannot bet more than chips held by player
					output += errorMsg + "You only have " + chips + " chip(s)";
				}
				else if (chipsBet < 0) {
					output += errorMsg + "Must be a positive number!";
				}

				else {
					output = content;
					this.chips -= chipsBet;
				}
			}
			catch (NumberFormatException e){ // String entered is not a valid integer
				output += errorMsg + "Bet must be a number!";				
			}
		}
		return output;
	}
	
	public boolean fold(int costToCall, String content) {
		if (content.equalsIgnoreCase("y") || content.equalsIgnoreCase("yes")) {
			return true;
		}
		else if (content.equalsIgnoreCase("n") || content.equalsIgnoreCase("no")) {
			if(costToCall > this.chips) {
				this.chips = 0;
			}
			else {
				this.chips -= costToCall;
			}
			return false;
		}
		return true;
	}
	
	public String match(String content, int currentCall){
		String output = "";

		if(inHand){
			int costToCall = currentCall - lastBet;
			if(!(content.equalsIgnoreCase("y") || content.equalsIgnoreCase("yes") || content.equalsIgnoreCase("n") || content.equalsIgnoreCase("no"))) {
				output = "@" + name + " \nWrong input. Please tweet 'yes' or 'no'";
			}
			else if (!fold(costToCall, content)){
				output += name + " matches with " + costToCall + " chip(s)";
			}
		}

		return output;
	}

	public int getChips() {
		return chips;
	}
	
	public String discard(String content){
		String output = "";
		Random rand = new Random();
		String errorMsg = "Discard error " + rand.nextInt(100) + ": ";

		if(inHand){
			boolean inRange = true;
			System.out.println("Content = " + content);
			String [] cards = content.split(" ");
			int [] discard = new int[cards.length];
			
			if (content.contains("x")) {
				output = "Discarded 0 cards";
			}
			else if (discard.length > 3) {
				output = errorMsg + "Wrong input. Maximum cards you can discard is 3";
				return output;
			}
			
			else {
				try {
					// Assigns and parses discarded cards to integers
					for (int i = 0; i < cards.length; i++) {
						System.out.println("Cards = " + cards[i]);
						
						discard[i] = Integer.parseInt(cards[i]);
												
						if (discard[i] < 0 || discard[i] > 4) {
							inRange = false;
							break;
						}
					}	

					if (inRange) {
						playerHand.discardCards(discard, discard.length);
						output = "Discarded " + discard.length + " cards";
						return output;
					}
					else {
						output = errorMsg + "Wrong input. Index entered is out of range, must be between 0-4";
						return output;
						//correctInput = false;
					}
				}
				catch (NumberFormatException e) {
					output = errorMsg + "Invalid input (must be integers)";
					return output;
				}
			}
		}
		return output;
	}

	public void resetBet(){
		lastBet = 0;
	}

	public static void main(String [ ] args)
	{
		DeckOfCards theDeck = new DeckOfCards();
		theDeck.shuffle();
		PokerPlayer player = new PokerPlayer(theDeck,"Luke");
		System.out.println("Hello " + player.name);


		System.out.println(player.playerHand);
		for (int i = 0; i < HandOfCards.HAND_SIZE; i++) {
			System.out.print(player.playerHand.getDiscardProbability(i) + "% ");
		}
		System.out.println();
		//player.discard();
		System.out.println(player.playerHand);


	}
}
